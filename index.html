<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Flashcard Spiel ‚Äî P√§dagogik & KI</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
  :root {
    --bg:#f5f8fb;
    --card-front:#e7f4ff;
    --card-back:#fff;
    --accent:#0066cc;
    --winner-bg:#ffeb3b;
  }

  body {
    margin:0;
    font-family:'Inter',sans-serif;
    background:linear-gradient(180deg,var(--bg),#eef6fb);
    padding:18px;
    display:flex;
    justify-content:center;
  }

  .app {
    width:100%;
    max-width:1100px;
    background:rgba(255,255,255,.95);
    padding:16px;
    border-radius:12px;
    box-shadow:0 8px 30px rgba(2,6,23,.08);
  }

  /* Top presenter control bar */
  .controls {
    display:flex;
    justify-content:flex-end;
    gap:6px;
    margin-bottom:14px;
  }
  .controls button {
    background:#0066cc;
    color:white;
    border:none;
    border-radius:8px;
    padding:7px 10px;
    cursor:pointer;
    font-weight:600;
  }
  .controls button.ghost {
    background:#eaeaea;
    color:#1d1d1d;
  }

  /* Situation box */
  .situation {
    background:white;
    border-radius:10px;
    padding:14px;
    font-weight:600;
    margin-bottom:14px;
  }

  /* Cards layout */
  .cards {
    display:flex;
    gap:12px;
    flex-wrap:nowrap;
    overflow-x:auto;
  }

  .card {
    width:240px;
    height:180px;
    flex:0 0 240px;
    border-radius:10px;
    perspective:1000px;
    position:relative;
    transition:transform .5s ease;
  }

  .card-inner {
    width:100%;
    height:100%;
    position:relative;
    transform-style:preserve-3d;
    transition:transform .6s;
  }

  .card.flipped .card-inner {
    transform:rotateY(180deg);
  }

  .card-face {
    position:absolute;
    inset:0;
    padding:12px;
    border-radius:10px;
    backface-visibility:hidden;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    text-align:center;
  }

  .card-front {
    background:var(--card-front);
    border:1px solid rgba(0,0,0,0.06);
  }

  .card-back {
    background:var(--card-back);
    border:1px solid rgba(0,0,0,0.08);
    transform:rotateY(180deg);
    font-size:13px;
    text-align:left;
  }

  .label-link {
    font-weight:700;
    color:var(--accent);
    text-decoration:none;
    font-size:18px;
  }

  .vote-badge {
    position:absolute;
    top:8px; left:8px;
    background:white;
    padding:4px 8px;
    border-radius:8px;
    font-weight:700;
    display:none;
  }

  .fav-btn {
    position:absolute;
    top:8px;
    right:8px;
    background:transparent;
    font-size:18px;
    border:none;
    cursor:pointer;
  }

  /* Winner mega effect */
  .card.winner {
    background:var(--winner-bg)!important;
    transform:rotate(-10deg) scale(1.15);
    border:4px solid gold;
    transition:transform .5s, background .4s;
    z-index:10;
  }

  #note {
    margin-top:18px;
    font-size:14px;
    text-align:center;
    color:#444;
  }
</style>
</head>
<body>
<div class="app">

  <div class="controls">
    <button id="claimPresenter">Presenter anmelden</button>
    <button id="releasePresenter" class="ghost" style="display:none">Presenter freigeben</button>
    <button id="startVoting" class="ghost" style="display:none">Voting starten</button>
    <button id="showResults" class="ghost" style="display:none">Ergebnisse zeigen</button>
    <button id="nextProblem" class="ghost" style="display:none">N√§chstes Problem</button>
  </div>

  <div id="situation" class="situation"></div>
  <div id="cards" class="cards"></div>
  <div id="note">Bitte w√§hlt auf eurem Ger√§t *eine* Karte.</div>

</div>


<!-- Firebase + Realtime Sync -->
<script type="module">
  
  <!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import {
    getDatabase, ref, onValue, set, update, runTransaction, serverTimestamp, get
  } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAaDK-oX9G-DXBRITymIo5SJiksoamOXCU",
    authDomain: "ki-faks-spiel.firebaseapp.com",
    databaseURL: "https://ki-faks-spiel-default-rtdb.firebaseio.com",
    projectId: "ki-faks-spiel",
    storageBucket: "ki-faks-spiel.firebasestorage.app",
    messagingSenderId: "510028538504",
    appId: "1:510028538504:web:2ad71ab74dc0c2682cf53d"
  };
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
const scenarios = [
    {title:"In deiner Kindergruppe habt ihr aktuell das Thema Transportmittel. Du m√∂chtest mit den Kindern einen Ausflug ins Deutsche Museum machen und eine F√ºhrung buchen welche speziell auf die dort ausgestellten Schiffe, Flugzeuge und Autos eingeht. Was kann dir dabei helfen die F√ºhrung zu buchen?", options:["ChatGPT","Microsoft Copilot","DeepL Write","Analog"]},
    {title:"Du arbeitest in einem Walkindergarten. Jedes Jahr erstellen die Kinder ein Buch mit getrockneten Bl√§ttern, Blumen und weiteren Pflanzen. Meist sind es Bl√§tter die du kennst. Mick (5 Jahre) fr√§gt dich diesmal bei einer Pflanze die du nicht kennst nach ihrem Namen.", options:["QuizGecko","Perplexity","Google Lense","Analog"]},
    {title:"Die Kinder wollen ein eigenes Bilderbuch. Du brauchst Illustrationen. Was probierst du?", options:["DALL¬∑E 3","Canva Magic Studio","Notion AI","Analog"]},
     {title:" Das traditionelle Wintertheatherst√ºck welches die Hort Kinder (6-10 Jahre) jedes Jahr auff√ºhren steht vor der T√ºr. Normalerweise w√§hlen die Kinder eines von f√ºnf Winterb√ºchern, welches du dann in ein Theaterst√ºck umwandelst. Dieses Jahr hast du erst 3 B√ºcher, welche die Kinder noch nicht kennen. Dir sind die Ideen f√ºr neue Winterb√ºcher ausgegangen.", options:["Poem Portraits","Canva Magic Studio","NextThreeBooks","Analog"]},   
    {title:"In deiner Vorschulgruppe lernen die Kinder aktuell Schuhe binden. Du m√∂chtest ein Schuh-binde-lied mit den Kindern machen, welches die Bewegung erkl√§rt und untermalt. Wie gehst du vor?", options:["Muzify","Suno","Soundraw","Analog"]}
  ];

const KI_DATA = [
  { label:"ChatGPT", info:"KI Sprachmodell f√ºr Texte & Ideen", url:"https://chat.openai.com" },
  { label:"YouTube", info:"Videos & Tutorials zu allen Themen", url:"https://youtube.com" },
  { label:"Google Lens", info:"Foto machen & KI analysiert Inhalte", url:"https://lens.google" },
  { label:"Gemini", info:"Multimodale KI von Google", url:"https://gemini.google.com" },
  { label:"Analog", info:"Fragen, B√ºcher, Freunde, eigene Ideen", url:null }
];



const room      = "klasse01";
let clientId    = "user-" + Math.random().toString(36).substring(2,9);
let presenterId = null;
let currentIdx  = 0;
let votes       = {};
let votingOpen  = false;

/* DOM */
const situationEl = document.getElementById("situation");
const cardsEl     = document.getElementById("cards");
const noteEl      = document.getElementById("note");


/* ----------------------------------------------------------------------
   üöÄ Render Scenario & Cards ‚Äî ALWAYS 4 cards
---------------------------------------------------------------------- */
function renderScenario(index) {
  const s = scenarios[index];
  situationEl.textContent = s.title;
  cardsEl.innerHTML = "";

  // Guarantee 4 cards, fill with Analog if needed
  const optionList = [...s.options];
  while(optionList.length < 4) optionList.push("Analog");

  optionList.forEach(label => {
    const ki = KI_DATA.find(x => x.label.toLowerCase() === label.toLowerCase()) || 
              { label, info:"Keine Info vorhanden", url:null };

    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <div class="card-inner">
        <div class="card-face card-front">
          <div class="vote-badge">0</div>
          <button class="fav-btn">‚òÜ</button>
          <a class="label-link" data-label="${ki.label}" 
             href="${ki.url || '#'}" target="_blank">${ki.label}</a>
        </div>
        <div class="card-face card-back">
          <b>${ki.label}</b><br>${ki.info}<br>
          ${ki.url ? `<a href="${ki.url}" target="_blank">Mehr erfahren</a>` : ""}
        </div>
      </div>
    `;

    // Flip on click
    card.addEventListener("click", e => {
      if(e.target.classList.contains("fav-btn")) return;
      card.classList.toggle("flipped");
    });

    // Voting star click
    card.querySelector(".fav-btn").addEventListener("click", async e => {
      e.stopPropagation();
      const newChoice = (votes[clientId] === ki.label ? null : ki.label);
      await set(ref(db, `/rooms/${room}/votes/${clientId}`), newChoice);
    });

    cardsEl.appendChild(card);
  });

  updateUIFromVotes();
}


/* ----------------------------------------------------------------------
   üßÆ Tally + Winner Highlight
---------------------------------------------------------------------- */
function updateUIFromVotes() {
  const counts = {};
  Object.values(votes).forEach(v => { if(v) counts[v] = (counts[v]||0) + 1 });

  document.querySelectorAll(".card").forEach(card=>{
    const label = card.querySelector(".label-link").dataset.label;
    const badge = card.querySelector(".vote-badge");
    const count = counts[label] || 0;

    badge.textContent = count;
    badge.style.display = votingOpen ? "block" : "none";
    card.classList.remove("winner");
  });

  if(!votingOpen && Object.values(counts).length > 0) highlightWinners(counts);
}

function highlightWinners(counts) {
  const max = Math.max(...Object.values(counts),0);
  if(max === 0) return;
  const winners = Object.keys(counts).filter(x => counts[x] === max);

  document.querySelectorAll(".card").forEach(card => {
    const label = card.querySelector(".label-link").dataset.label;
    if(winners.includes(label)) {
      card.classList.add("winner");
      cardsEl.prepend(card);
    }
  });
}


/* ----------------------------------------------------------------------
   üéÆ Presenter Controls
---------------------------------------------------------------------- */
document.getElementById("claimPresenter").onclick = ()=>{
  const pw = prompt("Presenter-Passwort eingeben:");
  if(pw === "teacher123"){  // change password here
    presenterId = clientId;
    updatePresenterUI();
  }
};

document.getElementById("releasePresenter").onclick = ()=>{
  presenterId = null;
  updatePresenterUI();
};

document.getElementById("startVoting").onclick = ()=>{
  votingOpen = true;
  updatePresenterUI();
  updateUIFromVotes();
};

document.getElementById("showResults").onclick = ()=>{
  votingOpen = false;
  updatePresenterUI();
  updateUIFromVotes();
};

document.getElementById("nextProblem").onclick = ()=>{
  votes = {};
  set(ref(db, `/rooms/${room}/votes`), {});
  currentIdx = (currentIdx + 1) % scenarios.length;
  renderScenario(currentIdx);
};


/* ----------------------------------------------------------------------
   üîÑ UI role hiding
---------------------------------------------------------------------- */
function updatePresenterUI() {
  const isPresenter = (presenterId === clientId);
  document.getElementById("releasePresenter").style.display = isPresenter ? "inline-block":"none";
  document.getElementById("startVoting").style.display     = isPresenter ? "inline-block":"none";
  document.getElementById("showResults").style.display     = isPresenter ? "inline-block":"none";
  document.getElementById("nextProblem").style.display     = isPresenter ? "inline-block":"none";
}


/* ----------------------------------------------------------------------
   üõ∞ Firebase Live Sync
---------------------------------------------------------------------- */
onValue(ref(db, `/rooms/${room}/votes`), snap=>{
  votes = snap.val() || {};
  updateUIFromVotes();
});


/* ----------------------------------------------------------------------
   üöÄ Init
---------------------------------------------------------------------- */
renderScenario(currentIdx);

</script>
</body>
</html>







